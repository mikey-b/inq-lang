class ConsoleObject: physical_object {
	this(string id) {
		super(id);
		objs["Controller"] = new ConsoleController;
	}
	
	class ConsoleController: DefaultController {
		override void start() {
			spawn((){
				string line;
				while((line = readln()) !is null) {
					ownerTid.send(cast(immutable)line);
				}
			});
			DefaultController.start();
		}
		
		override void send(JSONValue msg) {
			if ("to" !in msg) {
				writeln(toJSON(msg));
			} else {
				super.send(msg);
			}
		}
		
		override void process(JSONValue msg) {
			auto addr = address_t(msg["to"].str);
			if ((addr.physical == ".") || (thisAddr == addr.physical)) {
				super.send(msg);
			}
		}
	}
}